# MaxClaim n8n Workflow Templates

This directory contains n8n workflow templates for automating MaxClaim operations.

## Available Workflows

### 1. Lead Routing Workflow (`lead-routing-workflow.json`)

Automates the process of routing new leads to appropriate partners.

**Trigger**: Webhook on lead submission

**Flow**:
1. Receive lead data via webhook
2. Check lead type (conversion vs click)
3. For conversions: Match partners based on ZIP code and trade type
4. Create lead record in database
5. Send notification email to matched partner
6. Log result for analytics

**Environment Variables Required**:
- `MAXCLAIM_API_URL` - Base URL for MaxClaim API
- `SENDGRID_FROM_EMAIL` - Sender email address

### 2. Partner Onboarding Workflow (`partner-onboarding-workflow.json`)

Automates the partner signup and verification process.

**Trigger**: Webhook on partner signup

**Flow**:
1. Receive partner signup data
2. Send verification email
3. Wait 30 minutes
4. Check if email is verified
5. If verified: Send welcome email and auto-approve
6. If not verified: Send reminder email

**Environment Variables Required**:
- `MAXCLAIM_API_URL` - Base URL for MaxClaim API
- `MAXCLAIM_APP_URL` - Frontend app URL
- `SENDGRID_FROM_EMAIL` - Sender email address

## Setup Instructions

### Prerequisites

1. n8n instance running (self-hosted or n8n.cloud)
2. SendGrid account with API key
3. MaxClaim API running and accessible

### Import Workflows

1. Open your n8n instance
2. Go to Workflows > Import
3. Upload the JSON file for each workflow
4. Configure credentials:
   - Add SendGrid API credentials
   - Set environment variables in n8n settings

### Configure Webhooks

After importing, note the webhook URLs generated by n8n:

- Lead Routing: `https://your-n8n-instance/webhook/lead-submitted`
- Partner Onboarding: `https://your-n8n-instance/webhook/partner-signup`

Update your MaxClaim backend to call these webhooks at appropriate times.

### Testing

1. Use n8n's "Test Webhook" feature to send sample data
2. Verify the workflow executes correctly
3. Check that emails are sent via SendGrid
4. Confirm lead/partner records are created in MaxClaim

## Customization

These templates can be extended with:

- Slack notifications for sales team
- CRM integration (HubSpot, Salesforce)
- SMS notifications via Twilio
- Additional approval workflows
- Commission calculation triggers

## Webhook Payload Formats

### Lead Submission Webhook

```json
{
  "claimId": "uuid",
  "zipCode": "78701",
  "claimCategory": "roofing",
  "leadType": "conversion",
  "estimatedValue": 15000
}
```

### Partner Signup Webhook

```json
{
  "partnerId": "uuid",
  "email": "contractor@example.com",
  "contactPerson": "John Doe",
  "companyName": "ABC Roofing",
  "type": "contractor"
}
```
